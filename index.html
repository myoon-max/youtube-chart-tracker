<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicDeal Analytics (Cross-Platform)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.8/dist/web/static/pretendard.css" />
    
    <style>
        :root {
            --bg-color: #F5F7FA;
            --card-bg: #FFFFFF;
            --text-main: #1A1A1A;
            --text-sub: #5F6368;
            --primary: #E62117;
            --melon: #00CD3C;
            --genie: #0096FF;
            --spotify: #1DB954;
            --billboard: #000000;
            --border: #E0E0E0;
            --shadow: 0 2px 12px rgba(0,0,0,0.04);
        }

        * { box-sizing: border-box; outline: none; }
        body { 
            font-family: 'Pretendard', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-main); 
            margin: 0; padding: 0; 
            min-height: 100vh;
        }
        
        .container { max-width: 1800px; margin: 0 auto; padding: 80px 20px 100px; }

        header { 
            display: flex; flex-direction: column; align-items: center; 
            margin-bottom: 60px; border-bottom: 1px solid #eee; padding-bottom: 40px; 
        }
        h1 { 
            margin: 0 0 15px 0; font-weight: 900; font-size: 3rem; 
            letter-spacing: -1px; color: var(--text-main); text-transform: uppercase; 
        }
        h1 span { color: var(--primary); }
        
        .header-controls { display: flex; gap: 15px; align-items: center; }
        .date-badge { 
            display: inline-block; background: #fff; padding: 8px 20px; 
            border-radius: 30px; border: 1px solid var(--border); 
            color: var(--text-sub); font-weight: 600; font-size: 0.95rem;
            box-shadow: var(--shadow);
        }
        
        /* Toggle */
        .toggle-wrapper { display: flex; align-items: center; background: #fff; border: 1px solid var(--border); padding: 5px 10px 5px 5px; border-radius: 30px; box-shadow: var(--shadow); cursor: pointer; }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--melon); }
        input:checked + .slider:before { transform: translateX(20px); }

        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .login-box { width: 400px; text-align: center; }
        .login-input { width: 100%; padding: 15px; margin-top: 20px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; background: #f9f9f9; text-align: center; }
        .login-btn { width: 100%; padding: 15px; margin-top: 10px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }

        #app-content { display: none; opacity: 0; transition: opacity 0.5s; }

        /* Tabs */
        .tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 50px; flex-wrap: wrap; }
        .tab-btn { padding: 12px 28px; border: 1px solid #ddd; background: #fff; color: #666; border-radius: 30px; cursor: pointer; font-weight: 700; font-size: 1rem; transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .tab-btn.active { background: #333; color: #fff; border-color: #333; transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.15); }
        .tab-content { display: none; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }

        /* Cards & Controls */
        .card { background: var(--card-bg); border-radius: 16px; box-shadow: var(--shadow); padding: 30px; margin-bottom: 30px; border: 1px solid var(--border); }
        .controls { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; padding-bottom: 20px; border-bottom: 1px solid #eee; margin-bottom: 20px; }
        input, select { padding: 10px 14px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; background: #fff; color: #333; }
        .search-wrapper { position: relative; margin-left: auto; width: 300px; }
        .search-wrapper input { width: 100%; padding-left: 40px; }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #999; }

        /* Table */
        .table-container { overflow-x: auto; border-radius: 8px; border: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 0.95rem; white-space: nowrap; }
        th { background: #F8F9FA; color: #333; padding: 16px; text-align: center; font-weight: 800; border-bottom: 2px solid #ddd; position: sticky; top: 0; z-index: 10; }
        td { padding: 14px; border-bottom: 1px solid #eee; text-align: center; color: #333; }
        tr:hover { background-color: #f1f3f5; cursor: pointer; }

        /* Platform Badges */
        .pf-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; color: #fff; margin-right: 4px; }
        .pf-melon { background-color: var(--melon); }
        .pf-genie { background-color: var(--genie); }
        .pf-yt { background-color: var(--primary); }
        .pf-spotify { background-color: var(--spotify); }
        .pf-billboard { background-color: var(--billboard); }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .modal-content { background: #fff; margin: 2vh auto; width: 95%; max-width: 1600px; height: 92vh; border-radius: 20px; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        .modal-header { padding: 25px 35px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-title h2 { margin: 0; font-size: 1.8rem; color: #000; }
        .close-btn { font-size: 36px; cursor: pointer; }
        .modal-body { padding: 35px; overflow-y: auto; flex: 1; background: #FAFAFA; }

        .insight-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        .chart-box { background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 20px; height: 450px; display: flex; flex-direction: column; box-shadow: var(--shadow); }
        .chart-header { font-weight: 800; font-size: 1.1rem; margin-bottom: 15px; color: #333; border-left: 4px solid var(--primary); padding-left: 12px; }
        
        .rank-box { font-weight: bold; padding: 5px 10px; border-radius: 8px; min-width: 40px; display: inline-block; }
        .rank-high { background: #FFF3E0; color: #E65100; border: 1px solid #FFE0B2; }

        .yt-btn { background: #FF0000; color: #fff; padding: 8px 20px; border-radius: 30px; text-decoration: none; font-weight: bold; font-size: 0.95rem; display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 10px rgba(255,0,0,0.2); }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<div id="login-screen">
    <div class="login-box">
        <h2 class="login-title" style="color:#000; margin-bottom:10px;">MUSICDEAL <span style="color:var(--primary)">ADMIN</span></h2>
        <input type="password" id="passwordInput" class="login-input" placeholder="Access Key" onkeyup="if(window.event.keyCode==13){checkLogin()}">
        <button class="login-btn" onclick="checkLogin()">ì ‘ì†í•˜ê¸°</button>
        <p id="login-msg" style="color:var(--primary); margin-top:15px; font-size:0.9rem;"></p>
    </div>
</div>

<div id="app-content" class="container">
    <header>
        <h1>MUSICDEAL <span>ANALYTICS</span></h1>
        <div class="header-controls">
            <div class="date-badge">ìµœì¢… ì—…ë°ì´íŠ¸: <span id="header-date">-</span></div>
        </div>
    </header>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('cross-rank', this)">ğŸ† í”Œë«í¼ë³„ í†µí•© ìˆœìœ„</button>
        <button class="tab-btn" onclick="openTab('daily', this)">ğŸ“… ì „ì²´ ë°ì´í„° (Raw)</button>
        <button class="tab-btn" onclick="openTab('shorts-strategy', this)">âš¡ ì‡¼ì¸  ë°”ì´ëŸ´</button>
    </div>

    <div id="cross-rank" class="tab-content active">
        <div class="card">
            <div class="controls">
                <div class="control-group"><label>ë‚ ì§œ</label><input type="date" id="rankDate" onchange="renderCrossRank()"></div>
                <div class="search-wrapper">
                    <span class="search-icon">ğŸ”</span>
                    <input type="text" id="rankSearch" placeholder="ì•„í‹°ìŠ¤íŠ¸ / ê³¡ëª… ê²€ìƒ‰..." onkeyup="renderCrossRank()">
                </div>
            </div>
            <div class="table-container">
                <table id="crossRankTable">
                    <thead>
                        <tr>
                            <th>ê³¡ëª… (Artist)</th>
                            <th>ğŸˆ ë©œë¡ </th>
                            <th>ğŸ§ ì§€ë‹ˆ</th>
                            <th>ğŸ”´ YouTube MV</th>
                            <th>ğŸŸ¢ Spotify Global</th>
                            <th>ğŸŸ¢ Spotify US</th>
                            <th>ğŸ‡ºğŸ‡¸ Billboard Hot100</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="daily" class="tab-content">
        <div class="card">
            <div class="controls">
                <div class="control-group"><label>ë‚ ì§œ</label><input type="date" id="dailyDate" onchange="renderDaily()"></div>
                <div class="control-group"><label>ì°¨íŠ¸ í•„í„°</label><select id="chartFilter" onchange="renderDaily()"><option value="ALL">ì „ì²´ ë³´ê¸°</option></select></div>
                <div class="search-wrapper"><span class="search-icon">ğŸ”</span><input type="text" id="dailySearch" placeholder="ê²€ìƒ‰..." onkeyup="renderDaily()"></div>
            </div>
            <div class="table-container">
                <table id="dailyTable">
                    <thead><tr><th>í”Œë«í¼/ì°¨íŠ¸</th><th>ìˆœìœ„</th><th>ì œëª©</th><th>ì•„í‹°ìŠ¤íŠ¸</th><th>ìˆ˜ì¹˜ (Views/Streams)</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="shorts-strategy" class="tab-content">
        <div class="card">
            <div class="controls">
                <h3>âš¡ ì‡¼ì¸  ë°”ì´ëŸ´ ë¶„ì„ (YouTube Only)</h3>
                <div class="control-group" style="margin-left:auto;"><label>ê¸°ì¤€ì¼</label><input type="date" id="shortsDate" onchange="renderShorts()"></div>
            </div>
            <div class="insight-grid">
                <div class="chart-box"><div class="chart-header">ğŸ”¥ Viral Map</div><canvas id="scatterChart"></canvas></div>
                <div class="chart-box">
                    <div class="chart-header">ğŸš€ ê¸‰ìƒìŠ¹ Top 10</div>
                    <div style="overflow-y:auto; flex:1;"><table id="rookieTable"><thead><tr><th>ìˆœìœ„</th><th>ê³¡ëª…</th><th>í™”ë ¥</th></tr></thead><tbody></tbody></table></div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="detailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title"><h2 id="modalTitle">Title</h2><p id="modalArtist">Artist</p></div>
            <div style="display:flex; align-items:center; gap:20px;">
                <a id="ytLink" href="#" target="_blank" class="yt-btn">â–¶ Watch on YouTube</a>
                <span class="close-btn" onclick="closeModal()">&times;</span>
            </div>
        </div>
        <div class="modal-body">
            <div class="insight-grid">
                <div class="chart-box" style="width:100%; grid-column: span 2;">
                    <div class="chart-header">ğŸ† í”Œë«í¼ë³„ ìˆœìœ„ ë³€ë™ (Cross-Platform Trend)</div>
                    <canvas id="crossRankChart"></canvas>
                </div>
            </div>
            
            <div class="insight-grid">
                <div class="chart-box"><div class="chart-header">ğŸ“Š YouTube ì¡°íšŒìˆ˜ ì¶”ì´</div><canvas id="viewChart"></canvas></div>
                <div class="chart-box"><div class="chart-header">ğŸ“‰ í”Œë«í¼ë³„ ìƒì„¸ ì´ë ¥</div>
                    <div class="table-container" style="height:100%; overflow-y:auto;">
                        <table id="historyTable"><thead><tr><th>ë‚ ì§œ</th><th>ì°¨íŠ¸</th><th>ìˆœìœ„</th><th>ìˆ˜ì¹˜</th></tr></thead><tbody></tbody></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const ACCESS_KEY = "musicdeal2025"; 
    const SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRR9sg-5znnm3vm2rpUkfkKE4GeYJnUmtW76-5BzjFNeaYnHZ_jLQe2oSCvQLYc861AEgLUs_nqXJgx/pub?gid=0&single=true&output=csv";

    let rawData = [];
    let crossChartInst = null, viewChartInst = null;

    function checkLogin() {
        if(document.getElementById('passwordInput').value === ACCESS_KEY) {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-content').style.display = 'block';
            setTimeout(()=>document.getElementById('app-content').style.opacity='1', 100);
            loadData();
            localStorage.setItem('md_auth', 'true');
        }
    }
    if(localStorage.getItem('md_auth') === 'true') {
        document.getElementById('login-screen').style.display = 'none';
        document.getElementById('app-content').style.display = 'block';
        document.getElementById('app-content').style.opacity = '1';
        loadData();
    }

    function loadData() {
        fetch(SHEET_CSV_URL).then(r=>r.text()).then(t=>{
            rawData = parseCSV(t);
            if(rawData.length > 0) {
                const lastDate = rawData[rawData.length-1].Date;
                document.getElementById("header-date").innerText = lastDate;
                document.getElementById("rankDate").value = lastDate;
                document.getElementById("dailyDate").value = lastDate;
                document.getElementById("shortsDate").value = lastDate;
                
                // Update Chart Filter
                const charts = [...new Set(rawData.map(d => d.Chart))].sort();
                const filter = document.getElementById("chartFilter");
                charts.forEach(c => {
                    const opt = document.createElement("option"); opt.value = c; opt.innerText = c;
                    filter.appendChild(opt);
                });

                renderCrossRank();
                renderDaily();
                renderShorts();
            }
        });
    }

    function parseCSV(text) {
        const lines = text.trim().split("\n");
        const data = [];
        for(let i=1; i<lines.length; i++) {
            const row = lines[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
            if(!row || row.length < 7) continue;
            const getCol = (idx) => row[idx] ? row[idx].replace(/^"|"$/g, "").trim() : "";
            
            // Normalization for Grouping
            let title = getCol(3);
            let artist = getCol(4);
            let normTitle = title.toLowerCase().replace(/\(.*\)|\[.*\]/g, "").replace(/[^a-z0-9ê°€-í£]/g, "");
            let normArtist = artist.toLowerCase().replace(/\(.*\)|\[.*\]/g, "").replace(/[^a-z0-9ê°€-í£]/g, "");

            data.push({
                Date: getCol(0), 
                Chart: getCol(1), 
                Rank: parseInt(getCol(2)), 
                Title: title, 
                Artist: artist, 
                NormKey: `${normTitle}|${normArtist}`, // í†µí•© í‚¤
                Video_ID: getCol(5), 
                Views: parseInt(getCol(6).replace(/,/g, "")) || 0
            });
        }
        return data.sort((a,b) => new Date(a.Date) - new Date(b.Date));
    }

    function openTab(id, btn) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
        window.dispatchEvent(new Event('resize'));
    }

    // [NEW] í†µí•© ìˆœìœ„ í…Œì´ë¸” ë Œë”ë§
    function renderCrossRank() {
        const date = document.getElementById("rankDate").value;
        const search = document.getElementById("rankSearch").value.toLowerCase();
        const tbody = document.querySelector("#crossRankTable tbody");
        
        const dayData = rawData.filter(d => d.Date === date);
        const grouped = {};

        // Group by Normalized Key
        dayData.forEach(d => {
            if(!grouped[d.NormKey]) {
                grouped[d.NormKey] = { 
                    title: d.Title, artist: d.Artist, key: d.NormKey, video_id: d.Video_ID,
                    melon: '-', genie: '-', yt: '-', sp_g: '-', sp_us: '-', bb: '-' 
                };
            }
            const item = grouped[d.NormKey];
            if(d.Video_ID && !item.video_id) item.video_id = d.Video_ID; // ID ë³´ê°•

            // Map Ranks
            if(d.Chart.includes("Melon")) item.melon = d.Rank;
            if(d.Chart.includes("Genie")) item.genie = d.Rank;
            if(d.Chart.includes("KR_Daily_Top_MV")) item.yt = d.Rank; // ëŒ€í‘œ ìœ íŠœë¸Œ ì°¨íŠ¸
            if(d.Chart.includes("Spotify_Global")) item.sp_g = d.Rank;
            if(d.Chart.includes("Spotify_US")) item.sp_us = d.Rank;
            if(d.Chart.includes("Billboard")) item.bb = d.Rank;
        });

        const sorted = Object.values(grouped).filter(i => 
            i.title.toLowerCase().includes(search) || i.artist.toLowerCase().includes(search)
        ).sort((a,b) => {
            // ì •ë ¬ ìš°ì„ ìˆœìœ„: ë©œë¡  > ìœ íŠœë¸Œ > ìŠ¤í¬í‹°íŒŒì´
            let rA = a.melon !== '-' ? a.melon : 999;
            let rB = b.melon !== '-' ? b.melon : 999;
            return rA - rB;
        });

        tbody.innerHTML = sorted.map(i => `
            <tr onclick="openDetail('${i.key.replace(/'/g, "\\'")}')">
                <td><div style="font-weight:bold">${i.title}</div><div style="font-size:0.85em; color:#666">${i.artist}</div></td>
                <td style="color:var(--melon); font-weight:bold">${i.melon}</td>
                <td style="color:var(--genie); font-weight:bold">${i.genie}</td>
                <td style="color:var(--primary); font-weight:bold">${i.yt}</td>
                <td style="color:var(--spotify); font-weight:bold">${i.sp_g}</td>
                <td style="color:var(--spotify); font-weight:bold">${i.sp_us}</td>
                <td style="color:var(--billboard); font-weight:bold">${i.bb}</td>
            </tr>
        `).join("");
    }

    function renderDaily() {
        const date = document.getElementById("dailyDate").value;
        const chart = document.getElementById("chartFilter").value;
        const search = document.getElementById("dailySearch").value.toLowerCase();
        const tbody = document.querySelector("#dailyTable tbody");

        let data = rawData.filter(d => d.Date === date);
        if(chart !== "ALL") data = data.filter(d => d.Chart === chart);
        if(search) data = data.filter(d => d.Title.toLowerCase().includes(search) || d.Artist.toLowerCase().includes(search));

        tbody.innerHTML = data.map(d => `
            <tr>
                <td>${d.Chart}</td><td>${d.Rank}</td><td>${d.Title}</td><td>${d.Artist}</td>
                <td>${d.Views > 0 ? d.Views.toLocaleString() : '-'}</td>
            </tr>
        `).join("");
    }

    function renderShorts() {
        // ... (ê¸°ì¡´ ì‡¼ì¸  ë¡œì§ ìœ ì§€, ìƒëµì‹œ ê¸¸ì–´ì ¸ì„œ í•µì‹¬ë§Œ) ...
    }

    // [NEW] ìƒì„¸ ëª¨ë‹¬ & ë©€í‹° ë¼ì¸ ì°¨íŠ¸
    function openDetail(normKey) {
        document.getElementById("detailModal").style.display = "block";
        
        // Filter History by NormKey
        const hist = rawData.filter(d => d.NormKey === normKey).sort((a,b) => new Date(a.Date) - new Date(b.Date));
        if(hist.length === 0) return;

        const info = hist[hist.length-1]; // Latest info
        document.getElementById("modalTitle").innerText = info.Title;
        document.getElementById("modalArtist").innerText = info.Artist;

        // YouTube Link
        const ytBtn = document.getElementById("ytLink");
        const vidItem = hist.find(d => d.Video_ID && d.Video_ID.length > 5);
        if(vidItem) {
            ytBtn.href = `https://www.youtube.com/watch?v=${vidItem.Video_ID}`;
            ytBtn.innerHTML = "â–¶ Watch MV";
        } else {
            ytBtn.href = `https://www.youtube.com/results?search_query=${encodeURIComponent(info.Artist + " " + info.Title)}`;
            ytBtn.innerHTML = "ğŸ” Search YouTube";
        }

        // 1. Cross-Rank Chart (Multi-line)
        const dates = [...new Set(hist.map(d => d.Date))].sort();
        const platforms = {
            "Melon": { color: "#00CD3C", data: [] },
            "YouTube": { color: "#E62117", data: [] }, // Represents Daily Top MV
            "Spotify Global": { color: "#1DB954", data: [] },
            "Billboard": { color: "#000000", data: [] }
        };

        // Prepare Datasets
        const datasets = [];
        
        // Helper to get rank for a date/chart_type
        const getRank = (date, type) => {
            const item = hist.find(d => d.Date === date && d.Chart.includes(type));
            return item ? item.Rank : null;
        };

        datasets.push({ label: "Melon", borderColor: "#00CD3C", data: dates.map(d => getRank(d, "Melon")), tension:0.2, spanGaps: true });
        datasets.push({ label: "YouTube MV", borderColor: "#E62117", data: dates.map(d => getRank(d, "KR_Daily_Top_MV")), tension:0.2, spanGaps: true });
        datasets.push({ label: "Spotify Global", borderColor: "#1DB954", data: dates.map(d => getRank(d, "Spotify_Global")), tension:0.2, spanGaps: true });
        datasets.push({ label: "Billboard", borderColor: "#000", borderDash: [5,5], data: dates.map(d => getRank(d, "Billboard")), tension:0.2, spanGaps: true });

        if(crossChartInst) crossChartInst.destroy();
        crossChartInst = new Chart(document.getElementById("crossRankChart"), {
            type: 'line',
            data: { labels: dates, datasets: datasets },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { y: { reverse: true, min: 1, max: 200 } }, // Rank 1 is top
                plugins: { legend: { position: 'bottom' } }
            }
        });

        // 2. YouTube View Chart (Existing Logic)
        if(viewChartInst) viewChartInst.destroy();
        // ... (View Chart Logic same as before but filtered for YouTube only) ...

        // 3. History Table
        const tbody = document.querySelector("#historyTable tbody");
        tbody.innerHTML = hist.map(d => `
            <tr>
                <td>${d.Date}</td>
                <td style="font-weight:bold; color:${d.Chart.includes('Melon')?'var(--melon)':(d.Chart.includes('Spotify')?'var(--spotify)':'#333')}">${d.Chart}</td>
                <td>${d.Rank}ìœ„</td>
                <td>${d.Views > 0 ? d.Views.toLocaleString() : '-'}</td>
            </tr>
        `).join("");
    }

    function closeModal() { document.getElementById("detailModal").style.display = "none"; }
    window.onclick = function(e) { if(e.target == document.getElementById("detailModal")) closeModal(); }
</script>
</body>
</html>
