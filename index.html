<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MusicDeal Insight Analytics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #E62117; --secondary: #0F0F0F; --bg: #F9F9F9; --white: #ffffff; --gray: #606060; }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif; background: var(--bg); margin: 0; padding: 20px; color: var(--secondary); }
        
        .container { max-width: 1600px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 20px; font-weight: 800; color: var(--secondary); }
        .status { text-align: center; color: var(--gray); font-size: 0.9em; margin-bottom: 30px; }

        /* 1. í•µì‹¬ ì§€í‘œ ì¹´ë“œ (ì§„ì… ì»·) */
        .summary-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .summary-card { background: var(--white); padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-left: 5px solid var(--primary); }
        .summary-title { font-size: 0.9em; color: var(--gray); font-weight: 600; margin-bottom: 10px; display: block; }
        .summary-value { font-size: 1.8em; font-weight: 800; color: var(--secondary); }
        .summary-sub { font-size: 0.85em; color: var(--gray); margin-top: 5px; }

        /* íƒ­ ë©”ë‰´ */
        .tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { padding: 10px 24px; border: none; background: #e5e5e5; cursor: pointer; border-radius: 24px; font-weight: 700; font-size: 15px; color: var(--gray); transition: 0.2s; }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(230, 33, 23, 0.3); }
        
        .tab-content { display: none; background: white; padding: 25px; border-radius: 16px; box-shadow: 0 2px 20px rgba(0,0,0,0.03); }
        .tab-content.active { display: block; }

        /* í•„í„° ì»¨íŠ¸ë¡¤ */
        .controls { display: flex; flex-wrap: wrap; gap: 15px; align-items: center; margin-bottom: 20px; padding: 15px; background: #f1f1f1; border-radius: 8px; }
        .control-group { display: flex; align-items: center; gap: 8px; }
        .control-group label { font-weight: bold; font-size: 14px; }
        select, input[type="date"] { padding: 8px 12px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; min-width: 120px; }

        /* í…Œì´ë¸” */
        .table-wrap { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; white-space: nowrap; }
        th { background: var(--secondary); color: white; padding: 14px; position: sticky; top: 0; text-align: center; }
        td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        tr:hover { background-color: #fff5f5; cursor: pointer; }
        
        .rank-up { color: var(--primary); font-weight: bold; }
        .rank-down { color: blue; }
        .song-title { font-weight: 600; color: #333; text-align: left; }
        .highlight-cut { color: var(--primary); font-weight: 800; background: #fff0f0; }

        /* ëª¨ë‹¬ */
        .modal { display: none; position: fixed; z-index: 999; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(3px); }
        .modal-content { background-color: white; margin: 3% auto; padding: 30px; border-radius: 16px; width: 90%; max-width: 1100px; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .close-btn { float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .chart-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        @media (max-width: 800px) { .chart-grid { grid-template-columns: 1fr; } }

    </style>
</head>
<body>

<div class="container">
    <h1>ğŸš€ MusicDeal Insight Analytics</h1>
    
    <div class="summary-section">
        <div class="summary-card">
            <span class="summary-title">ğŸ‡°ğŸ‡· KR Daily MV Top 100 ì§„ì…ì»· (ì˜¤ëŠ˜)</span>
            <div class="summary-value" id="kr-mv-cut">-</div>
            <div class="summary-sub" id="kr-mv-desc">ë°ì´í„° ë¡œë”©ì¤‘...</div>
        </div>
        <div class="summary-card">
            <span class="summary-title">ğŸ‡ºğŸ‡¸ US Daily MV Top 100 ì§„ì…ì»· (ì˜¤ëŠ˜)</span>
            <div class="summary-value" id="us-mv-cut">-</div>
            <div class="summary-sub" id="us-mv-desc">ë°ì´í„° ë¡œë”©ì¤‘...</div>
        </div>
        <div class="summary-card">
            <span class="summary-title">ğŸ“… ë°ì´í„° ê¸°ì¤€ì¼</span>
            <div class="summary-value" id="current-date">-</div>
            <div class="summary-sub" id="data-count">-</div>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('daily')">ğŸ“… ë°ì¼ë¦¬ ìƒì„¸ ë¶„ì„</button>
        <button class="tab-btn" onclick="openTab('trend')">ğŸ“ˆ ì›”ê°„/ì—°ê°„ ì¶”ì´ (Trend)</button>
        <button class="tab-btn" onclick="openTab('shorts')">âš¡ ì‡¼ì¸  ì „ëµ</button>
        <button class="tab-btn" onclick="openTab('cross')">ğŸ”— í¬ë¡œìŠ¤ ì°¨íŠ¸</button>
    </div>

    <div id="daily" class="tab-content active">
        <div class="controls">
            <div class="control-group">
                <label>ğŸ“… ë‚ ì§œ:</label>
                <input type="date" id="dailyDate" onchange="renderDaily()">
            </div>
            <div class="control-group">
                <label>ğŸ³ï¸ êµ­ê°€:</label>
                <select id="countryFilter" onchange="updateChartFilter()">
                    <option value="ALL">ì „ì²´ ë³´ê¸°</option>
                    <option value="KR">ğŸ‡°ğŸ‡· í•œêµ­ (KR)</option>
                    <option value="US">ğŸ‡ºğŸ‡¸ ë¯¸êµ­ (US)</option>
                </select>
            </div>
            <div class="control-group">
                <label>ğŸ“Š ì°¨íŠ¸ ì¢…ë¥˜:</label>
                <select id="chartFilter" onchange="renderDaily()">
                    <option value="ALL">ì „ì²´ ì°¨íŠ¸</option>
                    </select>
            </div>
        </div>
        <div class="table-wrap"><table id="dailyTable"><thead></thead><tbody></tbody></table></div>
    </div>

    <div id="trend" class="tab-content">
        <h3>ğŸ“… ê¸°ê°„ë³„ ì§„ì… í•„ìš” ì¡°íšŒìˆ˜ ë³€í™” (Trend)</h3>
        <div class="table-wrap"><table id="trendTable"><thead></thead><tbody></tbody></table></div>
    </div>

    <div id="shorts" class="tab-content">
        <h3>âš¡ ì‡¼ì¸  ìƒì„±ëŸ‰ ê¸°ë°˜ ì§„ì… ì „ëµ</h3>
        <div class="controls">
            <label>ê¸°ì¤€ì¼: <input type="date" id="shortsDate" onchange="renderShorts()"></label>
        </div>
        <div class="table-wrap"><table id="shortsTable"><thead></thead><tbody></tbody></table></div>
    </div>

    <div id="cross" class="tab-content">
        <h3>ğŸ”— ë©€í‹° ì°¨íŠ¸ ì§„ì… ì•„í‹°ìŠ¤íŠ¸</h3>
        <div class="table-wrap"><table id="crossTable"><thead></thead><tbody></tbody></table></div>
    </div>
</div>

<div id="detailModal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2 id="modalTitle">ë…¸ë˜ ì œëª©</h2>
        <p id="modalArtist">ì•„í‹°ìŠ¤íŠ¸</p>
        <div class="chart-grid">
            <canvas id="viewChart"></canvas>
            <canvas id="rankChart"></canvas>
        </div>
        <h3>ğŸ“‹ ìƒì„¸ ì´ë ¥</h3>
        <div class="table-wrap"><table id="historyTable"><thead></thead><tbody></tbody></table></div>
    </div>
</div>

<script>
    // ============================================================
    // ğŸ”´ êµ¬ê¸€ ì‹œíŠ¸ CSV ë§í¬ ë¶™ì—¬ë„£ê¸°
    const SHEET_CSV_URL = "ì—¬ê¸°ì—_êµ¬ê¸€ì‹œíŠ¸_CSV_ë§í¬ë¥¼_ë¶™ì—¬ë„£ìœ¼ì„¸ìš”";
    // ============================================================

    let rawData = [];
    let uniqueCharts = [];

    // ì´ˆê¸°í™”
    fetch(SHEET_CSV_URL)
        .then(res => res.text())
        .then(text => {
            rawData = parseCSV(text); // ìˆ˜ì •ëœ íŒŒì„œ ì‚¬ìš©
            calculateDeltas();
            
            // ë°ì´í„° ë¡œë”© í›„ ì²˜ë¦¬
            if(rawData.length > 0) {
                const lastDate = rawData[rawData.length-1].Date;
                
                // ìƒë‹¨ ìš”ì•½ ì—…ë°ì´íŠ¸
                updateSummary(lastDate);
                
                // ì»¨íŠ¸ë¡¤ëŸ¬ ì„¸íŒ…
                document.getElementById("dailyDate").value = lastDate;
                document.getElementById("shortsDate").value = lastDate;
                
                // ì°¨íŠ¸ ëª©ë¡ ì¶”ì¶œ
                uniqueCharts = [...new Set(rawData.map(d => d.Chart))].sort();
                updateChartFilter(); // í•„í„° ì´ˆê¸°í™”

                // ë Œë”ë§
                renderDaily();
                renderTrend();
                renderShorts();
                renderCross();
            }
        });

    // ğŸ› ï¸ [ìˆ˜ì •ë¨] CSV íŒŒì„œ (ì œëª© ëŠê¹€ í˜„ìƒ ì™„ë²½ ìˆ˜ì •)
    function parseCSV(text) {
        const lines = text.trim().split("\n");
        const headers = lines[0].split(",").map(h => h.replace(/"/g, "").trim());
        
        const idx = { 
            date: headers.indexOf("Date"), 
            chart: headers.indexOf("Chart"), 
            rank: headers.indexOf("Rank"), 
            title: headers.indexOf("Title"), 
            artist: headers.indexOf("Artist"), 
            views: headers.indexOf("Views") 
        };

        const data = [];
        for(let i=1; i<lines.length; i++) {
            // ì½¤ë§ˆë¡œ ë‚˜ëˆ„ë˜, ë”°ì˜´í‘œ ì•ˆì˜ ì½¤ë§ˆëŠ” ë¬´ì‹œí•˜ëŠ” ì •ê·œì‹ (ì—¬ê¸°ê°€ í•µì‹¬!)
            const row = lines[i].match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
            
            if(!row || row.length < headers.length) continue;

            // ë°ì´í„° ì •ì œ
            const getCol = (i) => row[i] ? row[i].replace(/^"|"$/g, "").trim() : "";
            
            let vStr = getCol(idx.views).replace(/,/g, "");
            
            data.push({
                Date: getCol(idx.date),
                Chart: getCol(idx.chart),
                Rank: parseInt(getCol(idx.rank)),
                Title: getCol(idx.title), // ì´ì œ ì œëª© ì•ˆ ì˜ë¦¼
                Artist: getCol(idx.artist),
                Views: parseInt(vStr) || 0,
                Delta: 0
            });
        }
        return data.sort((a,b) => new Date(a.Date) - new Date(b.Date));
    }

    function calculateDeltas() {
        const map = {};
        rawData.forEach(d => {
            const key = `${d.Chart}|${d.Title}|${d.Artist}`;
            if(!map[key]) map[key] = [];
            map[key].push(d);
        });
        Object.values(map).forEach(list => {
            list.sort((a,b) => new Date(a.Date) - new Date(b.Date));
            for(let i=1; i<list.length; i++) {
                const diff = (new Date(list[i].Date) - new Date(list[i-1].Date))/(1000*3600*24);
                if(diff === 1) list[i].Delta = list[i].Views - list[i-1].Views;
            }
        });
    }

    // 1. ìƒë‹¨ ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸
    function updateSummary(date) {
        document.getElementById("current-date").innerText = date;
        document.getElementById("data-count").innerText = `ì´ ë°ì´í„° ${rawData.length.toLocaleString()}ê±´`;

        // KR Daily MV Cut (100ìœ„)
        const krMv = rawData.filter(d => d.Date === date && d.Chart === "KR_Daily_Top_MV" && d.Rank === 100);
        const usMv = rawData.filter(d => d.Date === date && d.Chart === "US_Daily_Top_MV" && d.Rank === 100);

        const setVal = (id, arr) => {
            const el = document.getElementById(id);
            const desc = document.getElementById(id.replace("-cut", "-desc"));
            if(arr.length > 0) {
                el.innerText = arr[0].Views.toLocaleString();
                desc.innerText = "Top 100 ì§„ì… ìµœì†Œ ì¡°íšŒìˆ˜";
            } else {
                el.innerText = "-";
                desc.innerText = "ë°ì´í„° ì—†ìŒ";
            }
        };
        
        setVal("kr-mv-cut", krMv);
        setVal("us-mv-cut", usMv);
    }

    // êµ­ê°€ í•„í„° ë³€ê²½ ì‹œ ì°¨íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸
    function updateChartFilter() {
        const country = document.getElementById("countryFilter").value;
        const chartSelect = document.getElementById("chartFilter");
        chartSelect.innerHTML = '<option value="ALL">ì „ì²´ ì°¨íŠ¸</option>';
        
        uniqueCharts.forEach(chart => {
            if(country === "ALL" || chart.startsWith(country)) {
                const opt = document.createElement("option");
                opt.value = chart;
                opt.innerText = chart;
                chartSelect.appendChild(opt);
            }
        });
        renderDaily(); // í…Œì´ë¸” ê°±ì‹ 
    }

    // ================= 1. ë°ì¼ë¦¬ ë Œë”ë§ (í•„í„° ì ìš©) =================
    function renderDaily() {
        const date = document.getElementById("dailyDate").value;
        const country = document.getElementById("countryFilter").value;
        const chartFilter = document.getElementById("chartFilter").value;
        
        const tbody = document.querySelector("#dailyTable tbody");
        const thead = document.querySelector("#dailyTable thead");
        thead.innerHTML = `<tr><th>ì°¨íŠ¸</th><th>ìˆœìœ„</th><th>ì œëª©</th><th>ì•„í‹°ìŠ¤íŠ¸</th><th>ì¡°íšŒìˆ˜</th><th>ì „ì¼ ëŒ€ë¹„</th></tr>`;

        let data = rawData.filter(d => d.Date === date);
        
        // í•„í„°ë§ ë¡œì§
        if(country !== "ALL") data = data.filter(d => d.Chart.startsWith(country));
        if(chartFilter !== "ALL") data = data.filter(d => d.Chart === chartFilter);

        let html = "";
        data.forEach(d => {
            let deltaStr = "-";
            if(d.Delta > 0) deltaStr = `<span class="rank-up">â–² ${d.Delta.toLocaleString()}</span>`;
            else if(d.Delta < 0) deltaStr = `<span class="rank-down">â–¼ ${Math.abs(d.Delta).toLocaleString()}</span>`;

            html += `<tr onclick="openDetail('${d.Title.replace(/'/g, "\\'")}', '${d.Artist.replace(/'/g, "\\'")}')">
                <td>${d.Chart}</td>
                <td>${d.Rank}</td>
                <td class="song-title">${d.Title}</td>
                <td>${d.Artist}</td>
                <td style="font-weight:bold">${d.Views.toLocaleString()}</td>
                <td>${deltaStr}</td>
            </tr>`;
        });
        tbody.innerHTML = html || `<tr><td colspan="6">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    }

    // ================= 2. ì›”ê°„/ì—°ê°„ ì¶”ì´ ë Œë”ë§ =================
    function renderTrend() {
        const tbody = document.querySelector("#trendTable tbody");
        const thead = document.querySelector("#trendTable thead");
        thead.innerHTML = `<tr><th>ê¸°ê°„ (ì›”/ì—°)</th><th>ì°¨íŠ¸</th><th>Top 10 í‰ê· </th><th>Top 20 í‰ê· </th><th class="highlight-cut">ì§„ì… ì»· (í‰ê· )</th></tr>`;

        // ì›”ë³„ë¡œ ì§‘ê³„
        const stats = {};
        rawData.forEach(d => {
            const key = d.Date.substring(0, 7) + "|" + d.Chart; // YYYY-MM
            if(!stats[key]) stats[key] = { sum10:0, cnt10:0, sum20:0, cnt20:0, sumCut:0, cntCut:0 };
            
            const s = stats[key];
            if(d.Rank <= 10) { s.sum10 += d.Views; s.cnt10++; }
            if(d.Rank >= 11 && d.Rank <= 20) { s.sum20 += d.Views; s.cnt20++; }
            
            // ì§„ì… ì»· ê¸°ì¤€ (íŠ¸ë Œë”© 20, ì‡¼ì¸  50, ë‚˜ë¨¸ì§€ 100)
            let cutRank = 100;
            if(d.Chart.includes("Trending")) cutRank = 20;
            if(d.Chart.includes("Shorts")) cutRank = 50;
            
            if(d.Rank === cutRank) { s.sumCut += d.Views; s.cntCut++; }
        });

        let html = "";
        // ìµœì‹ ìˆœ ì •ë ¬
        Object.keys(stats).sort().reverse().forEach(key => {
            const [month, chart] = key.split("|");
            const s = stats[key];
            const avg10 = s.cnt10 ? Math.round(s.sum10/s.cnt10) : 0;
            const avg20 = s.cnt20 ? Math.round(s.sum20/s.cnt20) : 0;
            const avgCut = s.cntCut ? Math.round(s.sumCut/s.cntCut) : 0;

            html += `<tr>
                <td>${month}</td>
                <td style="text-align:left">${chart}</td>
                <td>${avg10.toLocaleString()}</td>
                <td>${avg20.toLocaleString()}</td>
                <td class="highlight-cut">${avgCut.toLocaleString()}</td>
            </tr>`;
        });
        tbody.innerHTML = html;
    }

    // ================= 3. ì‡¼ì¸  ì „ëµ =================
    function renderShorts() {
        const date = document.getElementById("shortsDate").value;
        const tbody = document.querySelector("#shortsTable tbody");
        const thead = document.querySelector("#shortsTable thead");
        thead.innerHTML = `<tr><th>ì°¨íŠ¸</th><th>Top 10 ì§„ì… í•„ìš” (ì¼ê°„ ìƒì„±)</th><th>Top 20 ì§„ì… í•„ìš”</th><th>50ìœ„ ì»· (ì¼ê°„ ìƒì„±)</th></tr>`;

        const data = rawData.filter(d => d.Date === date && d.Chart.includes("Shorts"));
        const charts = [...new Set(data.map(d => d.Chart))];

        let html = "";
        charts.forEach(chart => {
            const cData = data.filter(d => d.Chart === chart);
            const calcAvg = (s, e) => {
                // ë¸íƒ€(ìƒì„±ëŸ‰)ê°€ ì–‘ìˆ˜ì¸ ê²ƒë§Œ í‰ê· 
                const seg = cData.filter(d => d.Rank >= s && d.Rank <= e && d.Delta > 0);
                return seg.length ? Math.round(seg.reduce((a,b)=>a+b.Delta,0)/seg.length) : 0;
            };
            
            const cutItem = cData.find(d => d.Rank === 50);
            const cutVal = cutItem && cutItem.Delta > 0 ? cutItem.Delta : 0;

            html += `<tr>
                <td>${chart}</td>
                <td style="color:red; font-weight:bold">+${calcAvg(1,10).toLocaleString()}ê°œ</td>
                <td>+${calcAvg(11,20).toLocaleString()}ê°œ</td>
                <td>+${cutVal.toLocaleString()}ê°œ</td>
            </tr>`;
        });
        tbody.innerHTML = html || `<tr><td colspan="4">ë°ì´í„° ë¶€ì¡± (ìµœì†Œ 2ì¼ì¹˜ í•„ìš”)</td></tr>`;
    }

    // ================= 4. í¬ë¡œìŠ¤ ì°¨íŠ¸ =================
    function renderCross() {
        const tbody = document.querySelector("#crossTable tbody");
        const thead = document.querySelector("#crossTable thead");
        thead.innerHTML = `<tr><th>ì•„í‹°ìŠ¤íŠ¸ - ë…¸ë˜</th><th>ì§„ì… ì°¨íŠ¸ ìˆ˜</th><th>ì°¨íŠ¸ ëª©ë¡</th><th>ìµœê³  ìˆœìœ„</th></tr>`;

        const lastDate = rawData[rawData.length-1].Date;
        const data = rawData.filter(d => d.Date === lastDate);
        const map = {};

        data.forEach(d => {
            const key = `${d.Artist} - ${d.Title}`;
            if(!map[key]) map[key] = { charts: [], minRank: 999 };
            map[key].charts.push(d.Chart);
            if(d.Rank < map[key].minRank) map[key].minRank = d.Rank;
        });

        const crosses = Object.entries(map).filter(([k,v]) => v.charts.length > 1);
        crosses.sort((a,b) => b[1].charts.length - a[1].charts.length);

        let html = "";
        crosses.forEach(([key, val]) => {
            html += `<tr onclick="openDetail('${key.split(" - ")[1].replace(/'/g, "\\'")}', '${key.split(" - ")[0].replace(/'/g, "\\'")}')">
                <td class="song-title">${key}</td>
                <td style="font-weight:bold; color:purple">${val.charts.length}</td>
                <td>${val.charts.join(", ")}</td>
                <td>${val.minRank}ìœ„</td>
            </tr>`;
        });
        tbody.innerHTML = html;
    }

    // ëª¨ë‹¬ ë° ì°¨íŠ¸ (ë™ì¼ ìœ ì§€)
    let vChart = null, rChart = null;
    function openDetail(title, artist) {
        document.getElementById("detailModal").style.display = "block";
        document.getElementById("modalTitle").innerText = title;
        document.getElementById("modalArtist").innerText = artist;

        const history = rawData.filter(d => d.Title === title && d.Artist === artist);
        const dates = [...new Set(history.map(d => d.Date))].sort();
        const charts = [...new Set(history.map(d => d.Chart))];

        // í‘œ
        const tbody = document.querySelector("#historyTable");
        tbody.innerHTML = `<thead><tr><th>ë‚ ì§œ</th><th>ì°¨íŠ¸</th><th>ìˆœìœ„</th><th>ì¡°íšŒìˆ˜</th><th>ì¦ê°</th></tr></thead><tbody>` + 
        history.sort((a,b)=>new Date(b.Date)-new Date(a.Date)).map(d => `<tr><td>${d.Date}</td><td>${d.Chart}</td><td>${d.Rank}</td><td>${d.Views.toLocaleString()}</td><td>${d.Delta}</td></tr>`).join("") + `</tbody>`;

        // ê·¸ë˜í”„
        if(vChart) vChart.destroy();
        if(rChart) rChart.destroy();

        const colors = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0'];
        const makeDataset = (key) => charts.map((c, i) => ({
            label: c,
            data: dates.map(dt => {
                const item = history.find(h => h.Date === dt && h.Chart === c);
                return item ? item[key] : null;
            }),
            borderColor: colors[i % colors.length],
            fill: false
        }));

        vChart = new Chart(document.getElementById('viewChart'), { type: 'line', data: { labels: dates, datasets: makeDataset('Views') }, options: { responsive: true, plugins: { title: { display: true, text: 'ì¡°íšŒìˆ˜ ì¶”ì´' } } } });
        rChart = new Chart(document.getElementById('rankChart'), { type: 'line', data: { labels: dates, datasets: makeDataset('Rank') }, options: { responsive: true, scales: { y: { reverse: true } }, plugins: { title: { display: true, text: 'ìˆœìœ„ ì¶”ì´' } } } });
    }
    
    function closeModal() { document.getElementById("detailModal").style.display = "none"; }
    window.onclick = function(e) { if(e.target == document.getElementById("detailModal")) closeModal(); }
    function openTab(id) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        event.currentTarget.classList.add('active');
    }
</script>
</body>
</html>
